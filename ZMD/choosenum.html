<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no"/>

	<link rel="stylesheet" type="text/css" href="public/bootstrap-3.3.4/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="public/css/common.css" />
	<link rel="stylesheet" type="text/css" href="public/artDialog/css/ui-dialog.css" />
    <link rel="stylesheet" type="text/css" href="public/css/demo.css" />

  <title></title>
</head>
<body>
    <div class="container-fluid">
        <div class="bcn">
            <ul class="pager">
                <li class="previous">
                <a href="javascript:window.history.go(-1);"><img src="public/images/new/left.png" alt="" width="24"></a>
                </li>
                <li class="center-block">号码选择</li>
            </ul>
        </div>

        <div class="choosenum">
            <form action="order.html" method="post">
                <input type="hidden" value="" name="spec_id">
                <input type="hidden" value="" name="pay_type">
                <input type="hidden" value="" name="offer">
                <input type="hidden" value="" name="plan">
                <input type="hidden" value="" name="number">
                <input type="hidden" value="" name="mn">
                <input type="hidden" value="" name="masterNumber">
                <p class="tit01">请选择主卡号码。【注意：如老用户需绑定副卡，则需选择同地区号码。】 </p>
                <div class="row" style="border-bottom: 1px solid #ededed;">
                    <div class="areaList col-xs-6">
                      <div id="selectBox" class="btn-group">
                         <button type="button" class="btn center-block dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                            <span class="txt"></span> <span class="caret"></span>
                         </button>
                         <ul>
                            <li>全部</li>
                         </ul>
                      </div>
                    </div>
                    <div class="numType tabCut col-xs-6">
                        <ul>
                            <li class="selected">1</li>
                            <li>2</li>
                            <li>3</li>
                        </ul>
                    </div>
                </div>
                <div class="row numList" style="min-height: 140px;">

                </div>
                <div class="page turnPage" style="clear: both;">
                    <table width="100%">
                        <tr>
                            <td>
                                <div class="text-center" id="prev">
				    <img src="public/images/new/pageleft.png" alt="" width="24">
				    <span>上一页</span>
                                </div>
                            </td>
                            <td>
                                <div class="text-center" id="next">
                                    <span>下一页</span>
				    <img src="public/images/new/pageright.png" alt="" width="24"> 
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="padding:15px;">
                    <div class="read">
                        <label>
                            <input type="radio" onclick="javascript:this.value='ok';" name="agree" value=""> 我已经阅并读同意
                        </label>
                        <a href="agreement.html">
                             <span style="color: red;" onclick="$('input[name=agree]').prop('checked',true)">《中国电信协议 招商银行个人定期存款止付担保协议》</span>
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 底部工具栏 -->
      <div class="app-fixed">
        <div class="container-fluid">
          <div class="app-nav">
            <div class="row">
              <div class="col-xs-3 col-sm-3 appItem">
                  <a target="_blank" href="http://im.189.cn/cw/?cf=1&amp;cid=8024&amp;manid=910"> 
                    <img src="public/images/new/bottom_service.png" alt=""></a>
                    <span>在线客服</span>
              </div>
              <div class="col-xs-3 col-sm-3 appItem">
                <a href="orderSearch.html">
                  <img src="public/images/new/bottom_search.png" alt=""></a>
                  <span>订单查询</span></div>
              <div class="col-xs-6 col-sm-6 appItem pull-right" style="padding-right: 0px;">
                <div style="background:#FF7600;height:46PX;line-height:46PX;color: #FFF;" id="numNext">
                     下一步
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

</body>
</html>

<script type="text/javascript" src="public/js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="public/bootstrap-3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="public/artDialog/dist/dialog-min.js"></script>
<script type="text/javascript" src="public/js/common.js"></script>
<script type="text/javascript" src="public/js/alert.js"></script>
<script type="text/javascript">
        (function($){
            $(document).ready(function(){

                if($('.bcn .center-block').html().indexOf('华为')>=0){
                    $('.choosenum .tit01 small').html('（副卡随机分配）');
                }
                var numConfig={
                    numberList:[{type:1,accnbr:"18900000001",price:"100",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000002",price:"",areaName:"上海市上海市上海市",areaId:"021"},{type:1,accnbr:"18900000003",price:"200",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000004",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000005",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000006",price:"",areaName:"上海市上海市上海市",areaId:"027"},{type:0,accnbr:"18900000007",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000008",price:"",areaName:"北京",areaId:"010"},{type:0,accnbr:"18900000009",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000010",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000011",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000012",price:"",areaName:"上海市上海市上海市",areaId:"027"},{type:0,accnbr:"18900000013",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000014",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000015",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000016",price:"",areaName:"上海市上海市上海市",areaId:"027"},{type:0,accnbr:"18900000017",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000018",price:"",areaName:"北京",areaId:"010"},{type:0,accnbr:"18900000019",price:"",areaName:"重庆",areaId:"028"},{type:0,accnbr:"18900000020",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000021",price:"",areaName:"黄石",areaId:"0714"},{type:0,accnbr:"18900000022",price:"",areaName:"上海市上海市上海市",areaId:"027"},{type:0,accnbr:"18900000023",price:"",areaName:"湖南",areaId:"028"},{type:0,accnbr:"18900000024",price:"",areaName:"北京",areaId:"010"},{type:0,accnbr:"18900000025",price:"",areaName:"安徽",areaId:"0755"},{type:0,accnbr:"18900000026",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000027",price:"",areaName:"宜昌",areaId:"0718"},{type:0,accnbr:"18900000028",price:"",areaName:"上海市上海市上海市",areaId:"027"},{type:0,accnbr:"18900000029",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000030",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000031",price:"",areaName:"武汉市武汉市武汉市",areaId:"027"},{type:0,accnbr:"18900000032",price:"",areaName:"北京",areaId:"010"}],
                    numberType:{0:'普通',1:'靓号'},
                    maxSelect:2
                };
                if(numConfig.maxSelect < 1){ numConfig.maxSelect=1; }
                var page={
                    curPage:0,
                    tempData:[],
                    numberList:[],
                    pageSize:10,
                    maxPage:1,
                    selected:[],
                    masterNumber:'',
                    resetData:function(list){
                        page.curPage=0;
                        page.maxPage=1;
                        //page.selected=[],
                        page.numberList=$.extend([], list);
                        page.maxPage=Math.ceil(page.numberList.length/page.pageSize);
                    },
                    init:function(configData){
                        var numTypeGroup={};//configData.numberType;
                        var areaGroup={};

                        $.each(numConfig.numberList,function(key,val){
                            if($.type(val.areaId)!='undefined'){
                                areaGroup[val.areaId]=val.areaName;
                            }

                            if($.type(val.type)!='undefined'){
                                numTypeGroup[val.type]=configData.numberType[val.type];
                            }

                        });

                        $(".numType ul").html('');
                        $.each(numTypeGroup,function(key,val){
                            $(".numType ul").append('<li data-val="'+key+'">'+val+'</li>');
                        });

                        var areaListObj=$(".areaList");
                        var areaCount=$.countOA(areaGroup);
                        areaListObj.find("ul").html('');
                        if(areaCount>5){
                            areaListObj.find("#selectBox").addClass('btn-group');
                            areaListObj.find("#selectBox button").show();
                            areaListObj.find("#selectBox ul").addClass('dropdown-menu').attr('role','menu');
                            //areaListObj.find("ul").append('<li class="all" data-val="0">全部</li>');
                        }else{
                            areaListObj.find("#selectBox ul").addClass('tabCut');
                        }

                        $.each(areaGroup,function(key,val){
                            areaListObj.find("ul").append('<li data-val="'+key+'">'+val+'</li>');
                        });

                        areaListObj.find("ul").find('li').first().click();

                    },
                    next:function(){
                        if(page.maxPage!=0 && (page.curPage+1)>page.maxPage){
                            alert('没有下一页了！');return;false;
                        }
                        page.curPage++;
                        page.print(page.curPage);
                    },
                    prev:function(){
                        if(page.maxPage!=0 && (page.curPage-1)<1){
                            alert('没有上一页了！');return;false;
                        }
                        page.curPage--;
                        page.print(page.curPage);
                    },
                    print:function(p){
                        var offset=(p-1)*page.pageSize;
                        var pageData=page.numberList.slice(offset,offset+page.pageSize);
                        $(".numList").html('');
                        $.each(pageData,function(key,val){
                            var checked= $.inArray(val.accnbr,page.selected)<0?'':'checked';
                            $(".numList").append('<div class="col-xs-6 none-padding"><label><input '+checked+' type="'+(numConfig.maxSelect>1?'checkbox':'radio')+'" name="number_tmp" value="'+val.accnbr+'">'+val.accnbr+'<small>'+(val.price!=''?'(预存'+val.price+')':'')+'</small></label></div>');
                        });
                    }
                };
                $(".page #next").click(function(){
                    page.next();
                });

                $(".page #prev").click(function(){
                    page.prev();
                });

                $(".numList").on('click','input',function(){
                    if($(this).is(':checked')==false){
                        var key=$.inArray($(this).val(),page.selected);
                        page.selected.splice(key,1);
                        return true;
                    }

                    if(numConfig.maxSelect>1){
                        if(page.selected.length>=numConfig.maxSelect){
                            alert('最多只能选'+numConfig.maxSelect+'个号码！');
                            return false;
                        }
                        if($.inArray($(this).val(),page.selected)<0){
                            page.selected.push($(this).val());
                        }
                    }else{
                        page.selected=[$(this).val()];
                    }
                    $(this).parents('form').first().find('input[name=number],input[name=masterNumber]').val('');
                });

                $(".areaList ul").on('click','li',function(){
                    var thisDataVal=$(this).attr('data-val');
                    $(this).parent().find('li').removeClass('active');
                    $(this).addClass('active');

                     var oldText = $(this).html();
                    
                    //地区长度大于5隐藏
                    
                     if (oldText.length > 5) {  

                         var newText = oldText.substring(0,5)+"...";  //5为保留的位数
                       
                        $('#selectBox').first().find('button .txt').html(newText);
                      } 
                      else{
                        $('#selectBox').first().find('button .txt').html(oldText);
                      } 

                    var data=[];
                    if(thisDataVal=='0'){
                        //下拉框选择全部的时候
                        data=numConfig.numberList;
                    }else{
                        $.each(numConfig.numberList,function(key,val){
                            if(val.areaId==thisDataVal){
                                data.push(val);
                            }
                        })
                    }

                    page.tempData=data;
                    $(".numType ul").find('li').first().click();
                });
                $(".numType ul").on('click','li',function(){
                    var thisDataVal=$(this).attr('data-val');
                    $(this).parent().find('li').removeClass('active');
                    $(this).addClass('active');
                    var data=[];
                    $.each(page.tempData,function(key,val){
                        if(val.type==thisDataVal){
                            data.push(val);
                        }
                    })
                    page.resetData(data);
                    $(".page #next").click();
                });

                page.init(numConfig);

                $("#numNext").click(function(e){
                    var fromObj=$(".choosenum form");
                    if(page.selected.length < 1){
                       alert('请选择号码！');return false;
                    }
                    if(page.selected.length > numConfig.maxSelect){
                       alert('最多只能选'+numConfig.maxSelect+'个号码！');return false;
                    }
                    if(page.selected.length < numConfig.maxSelect){
                       alert('最少需要选'+numConfig.maxSelect+'个号码！');return false;
                    }
                    if($("input[name=agree]:checked").length<1){
                       alert('请先阅读"中国电信协议"');return false;
                    }
                    if(numConfig.maxSelect > 1 && fromObj.find("input[name='masterNumber']").val() =='' ){
                        var html='';
                        html+='<div class="list-group" id="selectMasterNumber"><p>请选择一个号作为主号：</p>';
                        $.each(page.selected,function(key,val){
                            html+='<span class="list-group-item" data-val="'+val+'">'+val+'</span>';
                        });
                        html+='</div>';
                        $.dialog({
                            title:'选择主卡',
                            content:html,
                            width:'100%',
                            modal:true,
                            onshow:function(){
                                $("#selectMasterNumber .list-group-item").click(function(){
                                    $(this).parent().find('.list-group-item').removeClass('active');
                                    $(this).addClass('active');
                                })
                            },
                            ok:function(){
                                if($("#selectMasterNumber .active").length<1){
                                    alert('请选择一个号码作为主卡');
                                    return false;
                                }
                                fromObj.find("input[name='masterNumber']").val($("#selectMasterNumber .active").attr('data-val'));
                                window.location.href="order.html"
                            },
                            okValue:'确定'
                        });
                        return false
                    }

                    fromObj.find('input[name=number]').val(page.selected.join(','));
                    
                    return true;
                });

            });
        })(jQuery)
    </script>


